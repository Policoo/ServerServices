version: "3.8"

services:
  nginx:
    image: nginx:alpine
    container_name: nginx
    restart: unless-stopped
    depends_on:
      - pihole
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/inshellgagici.conf.template:/etc/nginx/templates/inshellgagici.conf.template:ro
    environment:
      DOMAIN: "${DOMAIN}"
    networks:
      - web

  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    restart: unless-stopped
    environment:
      TZ: "Europe/Amsterdam"
      FTLCONF_webserver_api_password: "${PIHOLE_WEBPASS}"
      FTLCONF_dns_listeningMode: "all"
      FTLCONF_misc_etc_dnsmasq_d: "true"
      FTLCONF_misc_dnsmasq_lines: "address=/.${DOMAIN}/${HOST_IP}"
    volumes:
      - ${DATA_STORAGE_BASE_DIR}/pihole/etc-pihole:/etc/pihole
      - ${DATA_STORAGE_BASE_DIR}/pihole/etc-dnsmasq.d:/etc/dnsmasq.d
    ports:
      - "53:53/tcp"
      - "53:53/udp"
    networks:
      - web
 
  filebrowser:
    image: filebrowser/filebrowser:v2-s6
    container_name: filebrowser
    restart: unless-stopped
    environment:
      FB_DATABASE: "/config/database.db"
      FB_ROOT: "/srv"
      FB_USERNAME: ${FB_USER}
      FB_PASSWORD: ${FB_PASS}
    volumes:
      - ${DATA_STORAGE_BASE_DIR}/filebrowser/nas-data:/srv
      - ${DATA_STORAGE_BASE_DIR}/filebrowser/config:/config
    networks:
      - web

  netdata:
    image: netdata/netdata:v1.47.4
    container_name: netdata
    restart: unless-stopped
    cap_add:
      - SYS_PTRACE
      - SYS_TIME
    environment:
      NETDATA_DISABLE_CLOUD: "1"
      NETDATA_REQUIRE_CLOUD: "0"
      DO_NOT_TRACK: "1"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /etc/passwd:/host/etc/passwd:ro
      - /etc/group:/host/etc/group:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro

      - ${DATA_STORAGE_BASE_DIR}/netdata-config:/etc/netdata
      - ${DATA_STORAGE_BASE_DIR}/netdata/lib:/var/lib/netdata
      - ${DATA_STORAGE_BASE_DIR}/netdata/cache:/var/cache/netdata
    networks:
      - web

networks:
  web:
    driver: bridge
